<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 80%;
        width: 60%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script type="text/javascript" src="./api_key.js"></script>
    <script type="text/javascript">
      function loadScript() {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://maps.googleapis.com/maps/api/js?key=' + api_key +
          '&callback=initMap';
        document.body.appendChild(script);
      }
    </script>
  </head>
  <body onload="loadScript()">
    <div id="map"></div><div id="model"></div>
    <form action="#" onchange="updateBox()" oninput="updateBox()">
      Height: <input value="3" id="height"/>
      Width: <input value="3" id="width"/>
      Angle: <input type="range" min="-90" max="90" value="0" class="slider"
                                                              id="angle"/>
    </form>

    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 39.61, lng: -105.8},
          zoom: 12
        });
        map.setMapTypeId('terrain');
        drawBox();
        map.addListener('center_changed', updateBox);
      }

      var box;
      function drawBox() {
        var boxCoords = [
        {lat: +0.01, lng: +0.01},
        {lat: +0.01, lng: -0.01},
        {lat: -0.01, lng: -0.01},
        {lat: -0.01, lng: +0.01}];
        box = new google.maps.Polygon({
          paths: boxCoords,
          strokeColor: '#0000FF',
          strokeOpacity: 0.6,
          strokeWeight: 5,
          fillColor: '#0000FF',
          fillOpacity: 0.3
        });
        box.setMap(map);
        updateBox();
      }

      function updateBox() {
        var miles_per_deg = 69.172;
        var cen = map.getCenter();
        var w = document.getElementById('width').value / miles_per_deg;
        var h = document.getElementById('height').value / miles_per_deg;
        var theta = -document.getElementById('angle').value * Math.PI / 180.;
        var s = Math.sin(theta);
        var c = Math.cos(theta);
        var cos_lat = Math.cos(cen.lat() * Math.PI / 180.);
        var boxCoords = [
        {lat: cen.lat()+cos_lat*( h*c+w*s), lng: cen.lng()-h*s+w*c},
        {lat: cen.lat()+cos_lat*( h*c-w*s), lng: cen.lng()-h*s-w*c},
        {lat: cen.lat()+cos_lat*(-h*c-w*s), lng: cen.lng()+h*s-w*c},
        {lat: cen.lat()+cos_lat*(-h*c+w*s), lng: cen.lng()+h*s+w*c}];
        box.setPath(boxCoords);
      }
    </script>
  </body>
</html>
